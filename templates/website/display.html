{% load static %}
<!doctype html>
<html lang="ar" dir="rtl" class="h-full antialiased">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <title>{% if school_name %}{{ school_name }} ‚Äî {% endif %}ŸÑŸàÿ≠ÿ© ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ∞ŸÉŸäÿ©</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --bg-deep:#020617;
      --glass-surface:rgba(15,23,42,.9);
      --glass-border:rgba(148,163,184,.3);

      --hero-from:#1e1b4b;
      --hero-to:#312e81;
      --hero-border:rgba(129,140,248,.5);

      --honor-from:rgba(15,15,20,.96);
      --honor-to:rgba(35,25,10,.9);
      --honor-border:rgba(251,191,36,.45);

      --accent-main:#6366f1;
      --accent-sub:#0ea5e9;
      --accent-honor:#f59e0b;
      --accent-ok:#22c55e;
      --accent-warn:#fb7185;

      --mesh1:rgba(79,70,229,.22);
      --mesh2:rgba(56,189,248,.22);

      /* 55"+ scale */
      --pad: 18px;
      --gap: 18px;
      --radius: 28px;

      --h1: clamp(26px, 1.6vw, 44px);
      --clock: clamp(50px, 3.4vw, 92px);
      --hero: clamp(54px, 4.2vw, 110px);
      --sub: clamp(16px, 1.15vw, 24px);
      --meta: clamp(14px, 0.95vw, 20px);
      --chip: clamp(12px, 0.9vw, 18px);

      /* Smaller slots */
      --slot-pad: 11px;
      --slot-gap: 9px;
      --slot-radius: 16px;
      --slot-chip: clamp(11px, 0.78vw, 16px);
      --slot-sub: clamp(13px, 0.95vw, 20px);
      --slot-meta: clamp(12px, 0.82vw, 18px);
    }

    body[data-theme="emerald"]{
      --bg-deep:#021a13;
      --glass-surface:rgba(4,34,25,.96);
      --glass-border:rgba(16,185,129,.35);

      --hero-from:#064e3b;
      --hero-to:#047857;
      --hero-border:rgba(52,211,153,.6);

      --honor-from:rgba(4,47,46,.96);
      --honor-to:rgba(6,95,70,.9);
      --honor-border:rgba(52,211,153,.55);

      --accent-main:#10b981;
      --accent-sub:#22c55e;
      --accent-honor:#a3e635;
      --accent-ok:#22c55e;
      --accent-warn:#f97316;

      --mesh1:rgba(16,185,129,.28);
      --mesh2:rgba(34,197,94,.26);
    }

    body[data-theme="rose"]{
      --bg-deep:#200112;
      --glass-surface:rgba(31,5,23,.96);
      --glass-border:rgba(244,114,182,.55);

      --hero-from:#831843;
      --hero-to:#be185d;
      --hero-border:rgba(244,114,182,.85);

      --honor-from:rgba(76,5,25,.96);
      --honor-to:rgba(159,18,57,.9);
      --honor-border:rgba(248,113,166,.8);

      --accent-main:#ec4899;
      --accent-sub:#f97316;
      --accent-honor:#fbbf24;
      --accent-ok:#22c55e;
      --accent-warn:#fb7185;

      --mesh1:rgba(244,114,182,.32);
      --mesh2:rgba(249,115,22,.26);
    }

    body{
      background-color:var(--bg-deep);
      color:#f8fafc;
      font-family:"IBM Plex Sans Arabic",sans-serif;
      overflow:hidden;
    }

    .mesh-bg{
      position:fixed; inset:0; z-index:-10;
      background:
        radial-gradient(circle at 0% 0%, var(--mesh1), transparent 55%),
        radial-gradient(circle at 100% 100%, var(--mesh2), transparent 55%);
    }

    .bento-card{
      background:var(--glass-surface);
      backdrop-filter:blur(26px);
      -webkit-backdrop-filter:blur(26px);
      border:1px solid var(--glass-border);
      box-shadow:0 18px 40px rgba(0,0,0,.55);
      border-radius:var(--radius);
      overflow:hidden;
    }

    .hero-card-gradient{
      background:linear-gradient(145deg,var(--hero-from),var(--hero-to));
      border-color:var(--hero-border);
    }

    .honor-card-style{
      background:linear-gradient(135deg,var(--honor-from),var(--honor-to));
      border-color:var(--honor-border);
      box-shadow:0 22px 55px -14px rgba(0,0,0,.7);
    }

    .num-font{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      font-variant-numeric:tabular-nums;
    }

    .no-scrollbar::-webkit-scrollbar{display:none;}
    .no-scrollbar{-ms-overflow-style:none; scrollbar-width:none;}

    .standby-viewport{overflow:hidden; position:relative;}

    @keyframes slideUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
    .animate-enter{animation:slideUp .6s cubic-bezier(.16,1,.3,1) forwards;}

    .mask-gradient-x{
      -webkit-mask-image:linear-gradient(to left,transparent,black 10%,black 90%,transparent);
      mask-image:linear-gradient(to left,transparent,black 10%,black 90%,transparent);
    }

    .chip{
      display:inline-flex; align-items:center; gap:.4rem;
      padding:.38rem .85rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.08);
      font-size:var(--chip);
      font-weight:900;
      white-space:nowrap;
    }
    .chip-ok{color:var(--accent-ok);background:rgba(34,197,94,.16);border-color:rgba(34,197,94,.30);}
    .chip-warn{color:var(--accent-warn);background:rgba(251,113,133,.16);border-color:rgba(251,113,133,.30);}

    /* Alerts */
    .alert-title{
      font-size:var(--sub);
      font-weight:1000;
      color:var(--accent-main);
      line-height:1.25;
      letter-spacing:-.01em;
    }
    .alert-divider{
      height:1px;
      background:rgba(255,255,255,.16);
      margin:10px 0;
    }
    .alert-details{
      font-size:var(--meta);
      font-weight:700;
      color:rgba(255,255,255,.92);
      line-height:1.55;
      display:-webkit-box;
      -webkit-box-orient:vertical;
      -webkit-line-clamp:3;
      overflow:hidden;
    }

    @media (min-width:2200px){
      :root{ --pad:26px; --gap:22px; --radius:34px; }
      .alert-details{-webkit-line-clamp:4;}
    }

    /* Slots smaller */
    .slot-item{
      background: rgba(255,255,255,.055);
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--slot-radius);
      padding: var(--slot-pad);
      box-shadow: 0 12px 26px rgba(0,0,0,.20);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      flex-direction:column;
      gap: var(--slot-gap);
      min-width:0;
    }
    .slot-top{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;}
    .slot-badges{display:flex;align-items:center;gap:8px;flex-wrap:wrap;min-width:0;}
    .slot-class{
      display:inline-flex; align-items:center;
      padding:.28rem .65rem;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.95);
      font-weight:900;
      font-size: var(--slot-chip);
      white-space:nowrap;
    }
    .slot-subject{
      display:inline-flex; align-items:center;
      padding:.28rem .65rem;
      border-radius:999px;
      background: rgba(14,165,233,.14);
      border:1px solid rgba(14,165,233,.28);
      color:#fff;
      font-weight:900;
      font-size: var(--slot-chip);
      white-space:nowrap;
      max-width:100%;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .slot-teacher{
      display:flex; align-items:center; gap:8px;
      font-size: var(--slot-sub);
      font-weight:900;
      color: rgba(255,255,255,.94);
      min-width:0;
      line-height:1.25;
    }
    .slot-teacher .label{
      font-size: var(--slot-meta);
      font-weight:800;
      color: rgba(255,255,255,.70);
      white-space:nowrap;
    }
    .slot-teacher .name{
      font-weight:1000;
      color:#fff;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      min-width:0;
    }

    /* Honor board */
    #exSlot img{
      width: clamp(120px, 6.2vw, 190px);
      height: clamp(120px, 6.2vw, 190px);
      border-radius: 24px;
      object-fit: cover;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      background: rgba(255,255,255,.06);
    }
    #exSlot .honor-wrap{display:flex; align-items:center; gap:18px; width:100%;}
    #exSlot .honor-meta{min-width:0; display:flex; flex-direction:column; gap:10px; width:100%;}
    #exSlot .honor-name{
      font-weight:1000;
      color:#fff;
      font-size: clamp(30px, 2.1vw, 52px);
      line-height:1.12;
      letter-spacing:-.01em;
    }
    #exSlot .honor-reason{
      color: rgba(255,255,255,.90);
      font-size: clamp(16px, 1.15vw, 24px);
      line-height:1.55;
      display:-webkit-box;
      -webkit-box-orient:vertical;
      -webkit-line-clamp:3;
      overflow:hidden;
    }
  </style>
</head>

<body
  class="h-screen flex flex-col selection:bg-[var(--accent-main)] selection:text-white"
  style="padding:var(--pad); gap:var(--gap);"
  data-theme="{% if theme %}{{ theme }}{% else %}indigo{% endif %}"
  data-token="{% if api_token %}{{ api_token }}{% endif %}"
  data-api-token="{% if api_token %}{{ api_token }}{% endif %}"
  data-snapshot-url="{% if snapshot_url %}{{ snapshot_url }}{% endif %}"
  data-school-id="{% if school_id %}{{ school_id }}{% endif %}"
  data-media-prefix="{% if MEDIA_URL %}{{ MEDIA_URL }}{% else %}/media/{% endif %}"
  data-refresh="{% if refresh_interval_sec %}{{ refresh_interval_sec }}{% else %}10{% endif %}"
  data-standby="{% if standby_scroll_speed %}{{ standby_scroll_speed }}{% else %}0.8{% endif %}"
  data-periods-speed="{% if periods_scroll_speed %}{{ periods_scroll_speed }}{% else %}0.5{% endif %}"
>
  <div class="mesh-bg"></div>

  <!-- Header -->
  <header class="bento-card px-6 py-3 flex items-center justify-between gap-4 shrink-0 min-h-[96px] z-10 animate-enter">
    <div class="flex items-center gap-5">
      <div class="h-16 w-16 rounded-3xl bg-white/5 border border-white/10 p-1.5 flex items-center justify-center shrink-0 shadow-inner overflow-hidden">
        <img id="schoolLogo" src="{% if logo_url %}{{ logo_url }}{% endif %}" class="{% if logo_url %}h-full w-full object-contain{% else %}hidden{% endif %}" alt="Logo">
        <div id="schoolLogoFallback" class="{% if logo_url %}hidden{% endif %}h-full w-full rounded-2xl bg-gradient-to-br from-[var(--accent-main)] to-[var(--accent-sub)] flex items-center justify-center text-3xl">
          üè´
        </div>
      </div>

      <div class="flex flex-col justify-center min-w-0">
        <h1 id="schoolName" class="font-black text-white tracking-tight" style="font-size:var(--h1); line-height:1.15;">
          {% if school_name %}{{ school_name }}{% else %}ŸÑŸàÿ≠ÿ© ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ∞ŸÉŸäÿ©{% endif %}
        </h1>
        <div class="flex items-center gap-2 text-slate-200 mt-1 overflow-hidden" style="font-size:var(--meta);">
          <span id="dateGregorian" class="truncate"></span>
          <span class="w-1 h-1 rounded-full bg-slate-500"></span>
          <span id="dateHijri" class="truncate text-[var(--accent-sub)] opacity-90"></span>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-4 pl-4 border-l border-white/10">
      <div id="clock" class="num-font font-black text-white tracking-tight drop-shadow-lg" style="font-size:var(--clock); line-height:1;">
        --:--
      </div>
    </div>
  </header>

  <!-- ‚úÖ Main: alerts moved into hero column -->
  <main class="flex-1 grid grid-cols-12 min-h-0" style="gap:var(--gap);">

    <!-- HERO COLUMN (right on your layout) -->
    <div class="col-span-12 xl:col-span-8 flex flex-col min-h-0" style="gap:var(--gap);">

      <!-- Alerts now same width as hero -->
      <section class="bento-card px-6 py-4 animate-enter shrink-0">
        <div id="alertContainer" class="px-5 py-4">
          <div id="alertTitle" class="alert-title">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÜÿ®ŸäŸá‚Ä¶</div>
          <div class="alert-divider"></div>
          <div id="alertDetails" class="alert-details">...</div>
        </div>
      </section>

      <!-- Hero -->
      <section class="bento-card hero-card-gradient flex-[2] flex flex-col relative group animate-enter shadow-2xl min-h-0">
        <div class="flex-1 flex items-center justify-between p-6 md:p-8 relative z-10 min-h-0">
          <div class="flex flex-col justify-center gap-4 max-w-2xl min-w-0">
            <div class="flex items-center gap-3">
              <span id="badgeKind" class="chip">--</span>
              <span id="heroRange" class="text-slate-100 num-font opacity-90 tracking-wide" style="font-size:var(--sub);">--:--</span>
            </div>

            <h2 id="heroTitle" class="font-black text-white tracking-tight drop-shadow-2xl leading-[1.1]" style="font-size:var(--hero);">
              ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...
            </h2>

            <div class="mt-2">
              <span class="text-indigo-100/90 font-semibold block mb-2" style="font-size:var(--meta);">ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ≠ÿßŸÑŸä:</span>
              <div id="currentScheduleList" class="flex flex-wrap gap-2">
                <span class="chip opacity-70">...</span>
              </div>
            </div>
          </div>

          <div class="relative w-40 h-40 md:w-52 md:h-52 shrink-0 hidden lg:block mr-2 md:mr-4">
            <svg class="w-full h-full -rotate-90 filter drop-shadow-[0_0_16px_rgba(99,102,241,0.55)]" viewBox="0 0 120 120">
              <circle cx="60" cy="60" r="54" stroke="rgba(255,255,255,0.2)" stroke-width="6" fill="none"/>
              <circle
                id="circleProgress"
                cx="60" cy="60" r="54"
                stroke="var(--accent-honor)"
                stroke-width="6"
                fill="none"
                stroke-linecap="round"
                style="stroke-dasharray:339.292; stroke-dashoffset:339.292; transition:stroke-dashoffset 1s linear;"
              />
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
              <span id="countdown" class="num-font font-black text-white tracking-tight" style="font-size:clamp(34px,2.6vw,70px);">--:--</span>
              <span class="text-indigo-50 mt-1 tracking-widest font-semibold" style="font-size:12px;">ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</span>
            </div>
          </div>
        </div>

        <div class="relative z-20 bg-slate-950/45 backdrop-blur-xl border-t border-white/5 px-5 md:px-6 py-4">
          <div class="flex items-center gap-4 md:gap-5">
            <div class="flex items-center gap-2 font-black text-indigo-100 shrink-0" style="font-size:var(--meta);">
              <span>ŸÖÿ≥ÿßÿ± ÿßŸÑŸäŸàŸÖ</span>
            </div>

            <div id="miniSchedule" class="flex-1 flex items-center gap-3 overflow-x-auto no-scrollbar mask-gradient-x" style="height: 56px;">
              <span class="text-slate-200/85 animate-pulse" style="font-size:var(--sub);">ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿßŸÑÿ¨ÿØŸàŸÑ...</span>
            </div>

            <div class="hidden xl:flex flex-col items-end border-r border-white/10 pr-4 mr-1 shrink-0 min-w-[180px]">
              <span class="text-slate-200 uppercase tracking-wide" style="font-size:11px;">ÿßŸÑÿ™ÿßŸÑŸä ŸÖÿ®ÿßÿ¥ÿ±ÿ©</span>
              <span id="nextLabel" class="font-black text-white truncate" style="font-size:var(--sub); max-width: 240px;">--</span>
            </div>
          </div>
        </div>

        <div class="absolute bottom-0 left-0 right-0 h-1 bg-slate-900/60">
          <div id="progressBar" class="h-full w-0 transition-all duration-1000"
               style="background:linear-gradient(90deg,var(--accent-main),var(--accent-sub),var(--accent-honor));"></div>
        </div>
      </section>

      <!-- Honor board -->
      <section class="bento-card honor-card-style flex-1 flex items-stretch px-6 md:px-8 relative overflow-hidden animate-enter min-h-0">
        <div class="flex items-center gap-6 md:gap-8 w-full z-10 h-full">
          <div class="flex flex-col gap-2 shrink-0 border-l border-[var(--accent-honor)]/45 pl-6 md:pl-8 justify-center min-w-[220px]">
            <div class="text-[var(--accent-honor)] font-black" style="font-size:clamp(22px,1.4vw,34px);">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ¥ÿ±ŸÅ</div>
            <div class="text-amber-100/80 flex items-center gap-2" style="font-size:var(--meta);">
              <span><span id="exIndex" class="text-amber-50 font-black">0</span> / <span id="exTotal" class="font-black">0</span></span>
            </div>
          </div>

          <div id="exSlot" class="flex-1 flex items-center justify-start h-full min-w-0">
            <div class="h-full flex items-center justify-center text-slate-300 w-full" style="font-size:var(--sub);">
              ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- PERIODS COLUMN (left): now gets full height (no alerts above it) -->
    <aside class="col-span-12 xl:col-span-4 flex flex-col min-h-0" style="gap:var(--gap);">
      <section class="bento-card flex-1 flex flex-col px-5 py-5 animate-enter min-h-0">
        <div class="flex justify-between items-center mb-3 pb-3 border-b border-white/5">
          <h3 class="font-black" style="color:var(--accent-ok); font-size:clamp(17px,1.05vw,24px);">ÿ≠ÿµÿµ ÿ¨ÿßÿ±Ÿäÿ©</h3>
          <span id="pcCount" class="chip chip-ok num-font" style="font-size:var(--slot-chip); padding:.26rem .65rem;">0</span>
        </div>
        <div class="standby-viewport flex-1 pr-1 min-h-0">
          <div id="periodClassesTrack" class="text-sm space-y-2"></div>
        </div>
      </section>

      <section class="bento-card flex-1 flex flex-col px-5 py-5 animate-enter min-h-0">
        <div class="flex justify-between items-center mb-3 pb-3 border-b border-white/5">
          <h3 class="font-black" style="color:var(--accent-warn); font-size:clamp(17px,1.05vw,24px);">ÿ≠ÿµÿµ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±</h3>
          <span id="sbCount" class="chip chip-warn num-font" style="font-size:var(--slot-chip); padding:.26rem .65rem;">0</span>
        </div>
        <div class="standby-viewport flex-1 pr-1 bg-gradient-to-br from-transparent to-black/10 rounded-2xl min-h-0">
          <div id="standbyTrack" class="text-sm space-y-2"></div>
        </div>
      </section>
    </aside>
  </main>

  <button
    id="fsBtn"
    class="fixed bottom-6 left-6 h-12 w-12 rounded-full bg-slate-950/85 backdrop-blur border border-slate-600/70 text-slate-300 hover:text-white hover:bg-[var(--accent-main)] transition-all flex items-center justify-center z-50 shadow-xl"
    type="button"
    aria-label="Fullscreen"
  >‚õ∂</button>

  <script src="{% static 'js/display.js' %}?v=20251215-layout-alerts-rightcol"></script>
</body>
</html>
