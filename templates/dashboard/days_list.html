{% extends "dashboard/_base.html" %}
{% load static %}

{% block title %}جداول الأيام الدراسية{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-8 animate-fade-in-up">
  
  <!-- Hero Section -->
  <div class="relative overflow-hidden rounded-3xl bg-slate-900 p-8 text-white shadow-2xl ring-1 ring-white/10">
    <!-- Abstract Background -->
    <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/20 via-purple-500/20 to-pink-500/20 opacity-50"></div>
    <div class="absolute -top-24 -right-24 h-96 w-96 rounded-full bg-blue-600/30 blur-3xl"></div>
    <div class="absolute -bottom-24 -left-24 h-96 w-96 rounded-full bg-emerald-600/30 blur-3xl"></div>
    <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150"></div>

    <div class="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-8">
      <div class="space-y-4">
        <div class="inline-flex items-center gap-2 rounded-full border border-emerald-500/30 bg-emerald-500/10 px-3 py-1 text-xs font-medium text-emerald-400 backdrop-blur-md">
          <span class="relative flex h-2 w-2">
            <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400 opacity-75"></span>
            <span class="relative inline-flex h-2 w-2 rounded-full bg-emerald-500"></span>
          </span>
          النظام نشط - الأسبوع الدراسي
        </div>
        <h1 class="text-4xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white via-blue-100 to-indigo-200 lg:text-5xl">
          جداول الأيام الدراسية
        </h1>
        <p class="max-w-2xl text-lg text-slate-400 font-light leading-relaxed">
          تحكم كامل في التوقيت الدراسي. قم بإدارة الحصص والفسح لكل يوم على حدة، مع تحديث فوري لشاشات العرض.
        </p>
      </div>

      <!-- Quick Actions / Current Status Badge -->
      <div class="hidden md:block">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-4 backdrop-blur-xl">
           <div class="flex items-center gap-4">
             <div class="rounded-full bg-white/10 p-3">
               <svg class="h-6 w-6 text-indigo-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
               </svg>
             </div>
           </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Grid -->
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
    <!-- Total Days -->
    <div class="group relative overflow-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-all hover:shadow-md hover:-translate-y-1 dark:border-slate-700 dark:bg-slate-800">
      <div class="absolute right-0 top-0 h-24 w-24 translate-x-8 translate-y-[-8px] rounded-full bg-blue-50 transition-transform group-hover:scale-150 dark:bg-blue-900/20"></div>
      <div class="relative">
        <dt class="truncate text-sm font-medium text-slate-500 dark:text-slate-400">عدد الأيام</dt>
        <dd class="mt-2 flex items-baseline gap-2">
          <span class="font-mono text-3xl font-bold tracking-tight text-slate-900 dark:text-white">{{ days|length|default:0 }}</span>
          <span class="text-xs text-slate-400">يوم</span>
        </dd>
      </div>
    </div>

    <!-- Avg Periods -->
    <div class="group relative overflow-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-all hover:shadow-md hover:-translate-y-1 dark:border-slate-700 dark:bg-slate-800">
      <div class="absolute right-0 top-0 h-24 w-24 translate-x-8 translate-y-[-8px] rounded-full bg-emerald-50 transition-transform group-hover:scale-150 dark:bg-emerald-900/20"></div>
      <div class="relative">
        <dt class="truncate text-sm font-medium text-slate-500 dark:text-slate-400">متوسط الحصص / يوم</dt>
        <dd class="mt-2 flex items-baseline gap-2">
          <span class="font-mono text-3xl font-bold tracking-tight text-slate-900 dark:text-white">
            {% with dcount=days|length %}
                {% if dcount %}
                  {% if avg_periods %}
                    {{ avg_periods|floatformat:1 }}
                  {% else %}
                    {% widthratio total_periods dcount 1 %}
                  {% endif %}
                {% else %}
                  0
                {% endif %}
              {% endwith %}
          </span>
          <span class="text-xs text-slate-400">حصة</span>
        </dd>
      </div>
    </div>

    <!-- Max Periods -->
    <div class="group relative overflow-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-all hover:shadow-md hover:-translate-y-1 dark:border-slate-700 dark:bg-slate-800">
      <div class="absolute right-0 top-0 h-24 w-24 translate-x-8 translate-y-[-8px] rounded-full bg-violet-50 transition-transform group-hover:scale-150 dark:bg-violet-900/20"></div>
      <div class="relative">
        <dt class="truncate text-sm font-medium text-slate-500 dark:text-slate-400">الأكثر كثافة</dt>
        <dd class="mt-2 flex items-baseline gap-2">
          <span class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">{{ max_periods_day.day_name|default:"-" }}</span>
        </dd>
      </div>
    </div>

     <!-- Min Periods -->
     <div class="group relative overflow-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-all hover:shadow-md hover:-translate-y-1 dark:border-slate-700 dark:bg-slate-800">
      <div class="absolute right-0 top-0 h-24 w-24 translate-x-8 translate-y-[-8px] rounded-full bg-amber-50 transition-transform group-hover:scale-150 dark:bg-amber-900/20"></div>
      <div class="relative">
        <dt class="truncate text-sm font-medium text-slate-500 dark:text-slate-400">الأقل كثافة</dt>
        <dd class="mt-2 flex items-baseline gap-2">
          <span class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">{{ min_periods_day.day_name|default:"-" }}</span>
        </dd>
      </div>
    </div>
  </div>

  <!-- Days List Grid -->
  <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5">
    {% for d in days %}
    <div class="group relative flex flex-col overflow-hidden rounded-3xl bg-white shadow-xl ring-1 ring-slate-900/5 transition-all duration-300 hover:-translate-y-2 hover:shadow-2xl dark:bg-slate-800 dark:ring-white/10 {% if not d.is_active %} grayscale-[0.8] opacity-75 {% endif %}">
       
       <!-- Status Stripe -->
       <div class="absolute top-0 left-0 right-0 h-1.5 bg-gradient-to-r {% if d.is_active %} from-emerald-400 to-teal-500 {% else %} from-slate-300 to-slate-400 {% endif %}"></div>

       <!-- Card Content -->
       <div class="flex-1 p-6">
          <div class="flex items-start justify-between">
            <div>
               <h3 class="text-2xl font-bold text-slate-800 dark:text-white">{{ d.day_name }}</h3>
               <span class="inline-block mt-2 text-[10px] font-semibold uppercase tracking-wider text-slate-400">
                  اليوم {{ forloop.counter }}
               </span>
            </div>
            
            {% if d.is_active %}
            <div class="flex h-8 w-8 items-center justify-center rounded-full bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400">
               <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
               </svg>
            </div>
            {% else %}
            <div class="flex h-8 w-8 items-center justify-center rounded-full bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-400">
               <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
               </svg>
            </div>
            {% endif %}
          </div>

          <div class="my-6 space-y-3">
             <div class="flex items-center justify-between rounded-xl bg-slate-50 p-3 dark:bg-slate-700/50">
               <span class="text-xs font-medium text-slate-500 dark:text-slate-400">الحصص</span>
               <span class="font-mono text-lg font-bold text-slate-700 dark:text-slate-200">{{ d.periods_count }}</span>
             </div>
             <div class="flex items-center justify-between rounded-xl bg-slate-50 p-3 dark:bg-slate-700/50">
               <span class="text-xs font-medium text-slate-500 dark:text-slate-400">الفسح</span>
               <span class="font-mono text-lg font-bold text-slate-700 dark:text-slate-200">{{ d.breaks_count }}</span>
             </div>
          </div>

          <div class="space-y-1">
             <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
                <div class="h-1.5 w-1.5 rounded-full bg-emerald-400"></div>
                <span>البداية: <span class="font-mono font-medium text-slate-700 dark:text-slate-300">{{ d.first_period_time|default:"--:--" }}</span></span>
             </div>
             <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
                <div class="h-1.5 w-1.5 rounded-full bg-rose-400"></div>
                <span>النهاية: <span class="font-mono font-medium text-slate-700 dark:text-slate-300">{{ d.last_period_time|default:"--:--" }}</span></span>
             </div>
          </div>
       </div>

       <!-- Action Area -->
       <div class="border-t border-slate-100 bg-slate-50/50 p-4 backdrop-blur dark:border-slate-700 dark:bg-slate-800/50">
          <div class="grid grid-cols-[1fr,auto] gap-3">
             <a href="{% url 'dashboard:day_edit' d.weekday %}" 
                class="flex items-center justify-center gap-2 rounded-xl bg-slate-900 py-2.5 text-sm font-bold text-white transition-all hover:bg-slate-700 hover:shadow-lg focus:ring-2 focus:ring-slate-900 focus:ring-offset-2 dark:bg-indigo-600 dark:hover:bg-indigo-500">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                تحرير
             </a>
             
             <form method="post" action="{% url 'dashboard:day_toggle' d.weekday %}">
               {% csrf_token %}
               <button type="submit" 
                       class="flex h-10 w-10 items-center justify-center rounded-xl border transition-all hover:shadow-md focus:ring-2 focus:ring-offset-2 {% if d.is_active %} border-rose-200 bg-white text-rose-500 hover:bg-rose-50 hover:border-rose-300 {% else %} border-emerald-200 bg-emerald-50 text-emerald-600 hover:bg-emerald-100 hover:border-emerald-300 {% endif %}"
                       title="{% if d.is_active %}تعطيل{% else %}تفعيل{% endif %}">
                  <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
               </button>
             </form>
          </div>
       </div>
    </div>
    {% empty %}
    <div class="col-span-full py-12 text-center">
       <div class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-slate-100 text-slate-400">
          <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
       </div>
       <h3 class="text-lg font-medium text-slate-900">لا توجد أيام مجدولة</h3>
       <p class="mt-1 text-slate-500">يرجى تهيئة الأيام الدراسية أولاً.</p>
    </div>
    {% endfor %}
  </div>

  <!-- Footer Info -->
  {% if days %}
  <div class="rounded-2xl border border-slate-200 bg-slate-50 p-6 text-sm text-slate-500 dark:border-slate-700 dark:bg-slate-800/50">
     <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <ul class="space-y-1">
           <li class="flex items-center gap-2">
              <svg class="h-4 w-4 text-emerald-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
              <span>جميع التغييرات تنعكس فوراً على الشاشات المرتبطة.</span>
           </li>
           <li class="flex items-center gap-2">
              <svg class="h-4 w-4 text-emerald-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
              <span>تأكد من تفعيل الأيام الصحيحة (الأجازات الرسمية يجب تعطيلها).</span>
           </li>
        </ul>
        <div class="text-right">
           <span class="block text-xs font-semibold uppercase tracking-wider text-slate-400">آخر تحديث</span>
           <span class="font-mono text-slate-700 dark:text-slate-300">{{ last_updated|default:"الآن" }}</span>
        </div>
     </div>
  </div>
  {% endif %}

</div>

<style>
/* Custom animations if needed, mostly using Tailwind utilities */
.num-font { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
</style>
{% endblock %}
