{% extends "dashboard/_base.html" %}

{% block title %}Ø§Ø´ØªØ±Ø§ÙƒÙŠ{% endblock %}
{% block page_title %}ØªÙØ§ØµÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©{% endblock %}
{% block page_description %}
Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ø®Ø·Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠØ©.
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto space-y-6">

  {# ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù… (ÙŠØ¸Ù‡Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©) #}
  {% if upcoming_subscription %}
    <div class="rounded-2xl border border-amber-200 bg-amber-50 text-amber-900 px-4 py-3 flex items-start gap-3">
      <div class="mt-0.5 text-lg">â³</div>
      <div class="space-y-1">
        <p class="font-semibold text-sm">Ø§Ø´ØªØ±Ø§Ùƒ Ù‚Ø§Ø¯Ù….</p>
        <p class="text-xs md:text-sm">
          Ø³ÙŠØ¨Ø¯Ø£ Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¯Ø±Ø³ØªÙƒÙ… ÙÙŠ {{ upcoming_subscription.display_starts_at|default:upcoming_subscription.starts_at }}
          {% if current_subscription %}
            Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ
            {% if current_subscription.display_ends_at %}
              ÙÙŠ {{ current_subscription.display_ends_at }}.
            {% else %}
              (Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…ÙØªÙˆØ­ Ø§Ù„Ù…Ø¯Ø©).
            {% endif %}
          {% else %}
            .
          {% endif %}
        </p>
      </div>
    </div>
  {% endif %}

  {# Ø´Ø±ÙŠØ· ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ #}
  {% if current_subscription %}
    {% if current_status_code == "expired" %}
      <div class="rounded-2xl border-2 border-rose-300 bg-gradient-to-r from-rose-50 to-orange-50 text-rose-900 px-5 py-4 shadow-lg">
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-rose-100 flex items-center justify-center text-xl">
            âš ï¸
          </div>
          <div class="flex-1 space-y-2">
            <p class="font-bold text-base">Ø§Ù†ØªÙ‡Ù‰ Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¯Ø±Ø³ØªÙƒÙ…</p>
            <p class="text-sm text-rose-800">
              Ø¨Ø¹Ø¶ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ù…ØªÙˆÙ‚ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø£Ø³ÙÙ„.
            </p>
            <div class="flex items-center gap-2 pt-1">
              <span class="text-lg">ğŸ‘‡</span>
              <span class="text-xs font-semibold text-rose-700">Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø£Ø³ÙÙ„ ÙˆØ§Ø®ØªØ± "ØªØ¬Ø¯ÙŠØ¯" Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„</span>
            </div>
          </div>
        </div>
      </div>
    {% elif current_status_code == "cancelled" %}
      <div class="rounded-2xl border-2 border-rose-300 bg-gradient-to-r from-rose-50 to-red-50 text-rose-900 px-5 py-4 shadow-lg">
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-rose-100 flex items-center justify-center text-xl">
            ğŸš«
          </div>
          <div class="flex-1 space-y-2">
            <p class="font-bold text-base">Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¯Ø±Ø³ØªÙƒÙ… Ù…Ù„ØºÙŠ</p>
            <p class="text-sm text-rose-800">
              ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©. Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„.
            </p>
            <div class="flex items-center gap-2 pt-1">
              <span class="text-lg">ğŸ‘‡</span>
              <span class="text-xs font-semibold text-rose-700">Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø£Ø³ÙÙ„ ÙˆØ§Ø®ØªØ± "Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯"</span>
            </div>
          </div>
        </div>
      </div>
    {% elif current_status_code == "active" %}
      <div class="rounded-2xl border border-emerald-200 bg-emerald-50 text-emerald-900 px-4 py-3 flex items-start gap-3">
        <div class="mt-0.5 text-lg">âœ…</div>
        <div class="space-y-1">
          <p class="font-semibold text-sm">Ø§Ø´ØªØ±Ø§ÙƒÙƒÙ… Ø³Ø§Ø±ÙŠ.</p>
          <p class="text-xs md:text-sm">
            Ø¬Ù…ÙŠØ¹ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ÙØ¹Ù‘Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.
            {% if current_subscription.display_ends_at %}
              ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ {{ current_subscription.display_ends_at }}.
            {% endif %}
          </p>
          {% if current_subscription.display_days_left is not None and current_subscription.display_days_left <= 3 %}
            <div class="mt-2 rounded-xl border border-amber-300 bg-amber-50 text-amber-900 px-3 py-2 flex items-center gap-2 animate-pulse">
              <span class="text-lg">âš ï¸</span>
              <span class="font-semibold">ØªÙ†Ø¨ÙŠÙ‡:</span>
              <span>Ù…ØªØ¨Ù‚ÙŠ {{ current_subscription.display_days_left }} ÙŠÙˆÙ… ÙÙ‚Ø· Ø¹Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©.</span>
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endif %}

  {% if subscription %}
    <div class="bg-white rounded-3xl shadow-lg border border-slate-100 overflow-hidden">
      <div class="px-5 md:px-8 py-5 border-b border-slate-100 flex items-center justify-between gap-4">
        <div class="space-y-1">
          <p class="text-xs text-slate-400">{{ primary_label|default:"Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" }}</p>
          <h3 class="text-lg md:text-2xl font-bold text-slate-900">
            Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¯Ø±Ø³Ø© {{ school.name }}
          </h3>
        </div>
        <div class="flex flex-col items-end gap-2">
          <div class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs md:text-sm font-semibold {% if current_subscription %}{{ current_status_badge_class }}{% else %}bg-amber-50 text-amber-700{% endif %}">
            <span class="w-2 h-2 rounded-full bg-current/60 border border-white/60"></span>
            <span>Ø§Ù„Ø­Ø§Ù„Ø©: {% if current_subscription %}{{ current_status_label }}{% else %}Ù‚Ø§Ø¯Ù…{% endif %}</span>
          </div>
          <p class="text-[11px] text-slate-400">
            Ø§Ù„ÙŠÙˆÙ…: {{ today }}
          </p>
        </div>
      </div>

      <div class="px-5 md:px-8 py-6 space-y-6">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="p-4 rounded-2xl border border-indigo-100 bg-indigo-50/60">
            <p class="text-xs text-slate-500 mb-1">Ø§Ù„Ø®Ø·Ø©</p>
            <p class="text-base md:text-lg font-bold text-indigo-700">
              {{ subscription.plan.name }}
            </p>
          </div>

          <div class="p-4 rounded-2xl border border-emerald-100 bg-emerald-50/70">
            <p class="text-xs text-slate-500 mb-1">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</p>
            <p class="text-base md:text-lg font-semibold text-emerald-700">
              {{ subscription.display_starts_at|default:subscription.starts_at }}
            </p>
          </div>

          <div class="p-4 rounded-2xl border border-amber-100 bg-amber-50/70">
            <p class="text-xs text-slate-500 mb-1">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</p>
            <p class="text-base md:text-lg font-semibold text-amber-700">
              {% if subscription.display_ends_at %}
                {{ subscription.display_ends_at }}
              {% else %}
                Ù…ÙØªÙˆØ­ Ø§Ù„Ù…Ø¯Ø©
              {% endif %}
            </p>
          </div>

          <div class="p-4 rounded-2xl border border-slate-100 bg-slate-50/70">
            <p class="text-xs text-slate-500 mb-1">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p>
            <p class="text-sm md:text-base text-slate-800">
              {% if current_subscription and current_status_code == "active" %}
                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø³Ø§Ø±ÙŠØŒ ÙˆØ¬Ù…ÙŠØ¹ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø¯Ø±Ø³Ø©.
              {% elif current_subscription and current_status_code == "expired" %}
                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠØŒ ÙˆØ³ÙŠØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯.
              {% elif current_subscription and current_status_code == "cancelled" %}
                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù„ØºÙŠ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŒ ÙŠÙ„Ø²Ù… Ø¥ØµØ¯Ø§Ø± Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„.
              {% elif upcoming_subscription and not current_subscription %}
                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ØŒ ÙŠÙ…ÙƒÙ†ÙƒÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„.
              {% else %}
                Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ.
              {% endif %}
            </p>
          </div>
        </div>

        {% if upcoming_subscription and current_subscription %}
          <div class="p-4 rounded-2xl border border-amber-100 bg-amber-50/60">
            <p class="text-xs text-slate-500 mb-2">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <p class="text-xs text-slate-500">Ø§Ù„Ø®Ø·Ø©</p>
                <p class="text-sm md:text-base font-semibold text-slate-900">{{ upcoming_subscription.plan.name }}</p>
              </div>
              <div>
                <p class="text-xs text-slate-500">ÙŠØ¨Ø¯Ø£ ÙÙŠ</p>
                <p class="text-sm md:text-base font-semibold text-amber-800">{{ upcoming_subscription.display_starts_at|default:upcoming_subscription.starts_at }}</p>
              </div>
            </div>
          </div>
        {% endif %}

        {% if subscription.notes %}
          <div class="p-4 rounded-2xl border border-slate-100 bg-slate-50">
            <p class="text-xs text-slate-500 mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</p>
            <p class="text-sm text-slate-800 whitespace-pre-line">
              {{ subscription.notes }}
            </p>
          </div>
        {% endif %}

        {# Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ Ù„ØªØ¬Ø¯ÙŠØ¯ Ø£Ùˆ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ #}

      </div>
    </div>

  {% else %}

    <div class="relative bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 rounded-3xl shadow-xl border-2 border-indigo-100 overflow-hidden">
      <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-200/20 rounded-full blur-3xl -mr-32 -mt-32"></div>
      <div class="absolute bottom-0 left-0 w-64 h-64 bg-purple-200/20 rounded-full blur-3xl -ml-32 -mb-32"></div>
      
      <div class="relative px-8 py-12 text-center space-y-5">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white text-4xl shadow-lg mb-2">
          ğŸ¯
        </div>
        
        <div class="space-y-2">
          <h3 class="text-2xl md:text-3xl font-bold text-slate-900">
            Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù…Ø¹Ù†Ø§!
          </h3>
          <p class="text-base md:text-lg text-slate-700 max-w-2xl mx-auto">
            Ù…Ø¯Ø±Ø³ØªÙƒÙ… Ù„Ø§ ØªÙ…ØªÙ„Ùƒ Ø§Ø´ØªØ±Ø§ÙƒØ§Ù‹ Ù†Ø´Ø·Ø§Ù‹ Ø­Ø§Ù„ÙŠØ§Ù‹
          </p>
        </div>

        <div class="inline-flex items-center gap-2 px-5 py-3 rounded-full bg-white/80 backdrop-blur-sm border border-indigo-200 shadow-sm">
          <span class="text-2xl">ğŸ‘‡</span>
          <p class="text-sm md:text-base font-semibold text-slate-800">
            Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†
          </p>
        </div>

        <div class="pt-4 flex items-center justify-center gap-4">
          <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-white/60 backdrop-blur-sm">
            <span class="text-xl">âœ¨</span>
            <span class="text-xs md:text-sm font-medium text-slate-700">Ø³Ù‡Ù„ ÙˆØ³Ø±ÙŠØ¹</span>
          </div>
          <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-white/60 backdrop-blur-sm">
            <span class="text-xl">ğŸš€</span>
            <span class="text-xs md:text-sm font-medium text-slate-700">ØªÙØ¹ÙŠÙ„ ÙÙˆØ±ÙŠ</span>
          </div>
        </div>
      </div>
    </div>

  {% endif %}


  <div class="bg-white rounded-3xl shadow-lg border border-slate-100 overflow-hidden">
    <div class="px-5 md:px-8 py-5 border-b border-slate-100">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div>
          <h3 class="text-lg md:text-xl font-bold text-slate-900">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
          <p class="text-xs md:text-sm text-slate-500 mt-1">
            Ø§Ø±ÙØ¹ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŒ ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©. ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø±ÙØ¹ Ø§Ù„Ø·Ù„Ø¨.
          </p>
        </div>

        <div class="inline-flex items-center rounded-2xl bg-slate-100 p-1 w-full md:w-auto">
          <button
            type="button"
            data-tab="renewal"
            class="request-tab-btn flex-1 md:flex-none px-4 py-2 rounded-xl text-sm font-bold transition {% if active_request_tab == 'renewal' %}bg-white text-slate-900 shadow-sm{% else %}text-slate-600 hover:text-slate-900{% endif %}"
          >
            ØªØ¬Ø¯ÙŠØ¯
          </button>
          <button
            type="button"
            data-tab="new"
            class="request-tab-btn flex-1 md:flex-none px-4 py-2 rounded-xl text-sm font-bold transition {% if active_request_tab == 'new' %}bg-white text-slate-900 shadow-sm{% else %}text-slate-600 hover:text-slate-900{% endif %}"
          >
            Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
      </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ -->
    <div class="px-5 md:px-8 py-6 bg-gradient-to-br from-emerald-50 to-teal-50 border-b border-slate-100">
      <div class="max-w-3xl mx-auto">
        <div class="flex items-center gap-3 mb-4">
          <div class="flex-shrink-0 w-12 h-12 rounded-xl bg-emerald-600 flex items-center justify-center text-2xl shadow-lg">
            ğŸ¦
          </div>
          <div>
            <h4 class="text-base md:text-lg font-bold text-slate-900">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h4>
            <p class="text-xs text-slate-600">Ù‚Ù… Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ Ø«Ù… Ø§Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„</p>
          </div>
        </div>

        <div class="bg-white rounded-2xl border-2 border-emerald-100 shadow-sm overflow-hidden">
          <div class="bg-gradient-to-r from-emerald-600 to-teal-600 px-4 py-3">
            <p class="text-white font-bold text-sm">Ù…Ù†ØµÙˆØ± Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø­Ø§Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</p>
            <p class="text-emerald-100 text-xs">Ø¨Ø±Ù…Ø¬Ø© Ùˆ ØªØ·ÙˆÙŠØ±</p>
          </div>

          <div class="p-4 space-y-3">
            <!-- Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ -->
            <div class="flex items-center justify-between gap-3 p-3 rounded-xl bg-slate-50 hover:bg-slate-100 transition">
              <div class="flex-1">
                <p class="text-[10px] md:text-xs text-slate-500 font-semibold mb-1">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</p>
                <p class="text-sm md:text-base font-bold text-slate-900">Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ</p>
              </div>
            </div>

            <!-- Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ -->
            <div class="flex items-center justify-between gap-3 p-3 rounded-xl bg-slate-50 hover:bg-slate-100 transition">
              <div class="flex-1">
                <p class="text-[10px] md:text-xs text-slate-500 font-semibold mb-1">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                <p class="text-sm md:text-base font-mono font-bold text-slate-900 select-all" dir="ltr">660000010006086220957</p>
              </div>
              <button 
                onclick="copyToClipboard('660000010006086220957', this)"
                class="flex-shrink-0 px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-semibold transition shadow-sm hover:shadow active:scale-95"
              >
                <span class="copy-text">Ù†Ø³Ø®</span>
              </button>
            </div>

            <!-- Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† -->
            <div class="flex items-center justify-between gap-3 p-3 rounded-xl bg-slate-50 hover:bg-slate-100 transition">
              <div class="flex-1">
                <p class="text-[10px] md:text-xs text-slate-500 font-semibold mb-1">Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† (IBAN)</p>
                <p class="text-sm md:text-base font-mono font-bold text-slate-900 select-all break-all" dir="ltr">SA8580000660608016220957</p>
              </div>
              <button 
                onclick="copyToClipboard('SA8580000660608016220957', this)"
                class="flex-shrink-0 px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-semibold transition shadow-sm hover:shadow active:scale-95"
              >
                <span class="copy-text">Ù†Ø³Ø®</span>
              </button>
            </div>

            <!-- ÙƒÙˆØ¯ Ø³ÙˆÙŠÙØª -->
            <div class="flex items-center justify-between gap-3 p-3 rounded-xl bg-slate-50 hover:bg-slate-100 transition">
              <div class="flex-1">
                <p class="text-[10px] md:text-xs text-slate-500 font-semibold mb-1">ÙƒÙˆØ¯ Ø³ÙˆÙŠÙØª (SWIFT)</p>
                <p class="text-sm md:text-base font-mono font-bold text-slate-900 select-all" dir="ltr">RJHISARI</p>
              </div>
              <button 
                onclick="copyToClipboard('RJHISARI', this)"
                class="flex-shrink-0 px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-semibold transition shadow-sm hover:shadow active:scale-95"
              >
                <span class="copy-text">Ù†Ø³Ø®</span>
              </button>
            </div>
          </div>

          <div class="px-4 pb-4">
            <div class="flex items-start gap-2 p-3 rounded-xl bg-amber-50 border border-amber-200">
              <span class="text-base flex-shrink-0 mt-0.5">ğŸ’¡</span>
              <p class="text-xs text-amber-900">
                <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŒ Ù‚Ù… Ø¨Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ø¥ÙŠØµØ§Ù„ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªØ³Ø±ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="px-5 md:px-8 py-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
      <div id="tab-renewal" class="rounded-2xl border border-slate-100 bg-slate-50/60 p-5 {% if active_request_tab != 'renewal' %}hidden{% endif %}">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h4 class="font-bold text-slate-900">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</h4>
            <p class="text-xs text-slate-500 mt-1">
              {% if subscription %}
                Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span class="font-semibold text-slate-700">{{ subscription.plan.name }}</span>
                {% if subscription.plan.price %}
                  â€” Ø§Ù„Ø³Ø¹Ø±: <span class="font-semibold text-slate-700">{{ subscription.plan.price }} Ø±.Ø³</span>
                {% endif %}
              {% else %}
                Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§Ùƒ Ø­Ø§Ù„ÙŠ.
              {% endif %}
            </p>
          </div>
        </div>

        <div class="mt-4 rounded-2xl border border-slate-200 bg-white p-4">
          <p class="text-xs font-bold text-slate-700 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø©</p>
          {% if renewal_plan_details %}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
              <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
                <p class="text-[11px] text-slate-500">Ø³Ø¹Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø±.Ø³)</p>
                <p class="font-bold text-slate-900">{{ renewal_plan_details.price|default:"â€”" }}</p>
              </div>
              <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
                <p class="text-[11px] text-slate-500">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</p>
                <p class="font-bold text-slate-900">{% if renewal_plan_details.duration_days %}{{ renewal_plan_details.duration_days }}{% else %}â€”{% endif %}</p>
              </div>
              <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
                <p class="text-[11px] text-slate-500">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</p>
                <p class="font-bold text-slate-900">{% if renewal_plan_details.max_screens %}{{ renewal_plan_details.max_screens }}{% else %}ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯{% endif %}</p>
              </div>
            </div>
          {% else %}
            <p class="text-sm text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø© Ø­Ø§Ù„ÙŠØ© Ù„Ù„ØªØ¬Ø¯ÙŠØ¯. Ø§Ø³ØªØ®Ø¯Ù… ØªØ¨ÙˆÙŠØ¨ "Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯".</p>
          {% endif %}
        </div>

        {% if subscription %}
          <form method="post" enctype="multipart/form-data" class="mt-4 space-y-3">
            {% csrf_token %}
            <input type="hidden" name="action" value="renewal">

            {% if renew_form.non_field_errors %}
              <div class="text-sm text-rose-700">{{ renew_form.non_field_errors }}</div>
            {% endif %}

            <div>
              <label class="block text-xs font-semibold text-slate-700 mb-1">{{ renew_form.receipt_image.label }}</label>
              {{ renew_form.receipt_image }}
              {% if renew_form.receipt_image.errors %}
                <div class="text-xs text-rose-700 mt-1">{{ renew_form.receipt_image.errors }}</div>
              {% endif %}
            </div>

            <div>
              <label class="block text-xs font-semibold text-slate-700 mb-1">{{ renew_form.transfer_note.label }}</label>
              {{ renew_form.transfer_note }}
              {% if renew_form.transfer_note.errors %}
                <div class="text-xs text-rose-700 mt-1">{{ renew_form.transfer_note.errors }}</div>
              {% endif %}
            </div>

            <button type="submit" class="w-full rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2">
              Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
            </button>
          </form>
        {% else %}
          <div class="mt-4 text-sm text-slate-600">
            Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ¬Ø¯ÙŠØ¯ Ø¨Ø¯ÙˆÙ† Ø§Ø´ØªØ±Ø§Ùƒ Ø­Ø§Ù„ÙŠ. Ø§Ø³ØªØ®Ø¯Ù… "Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯".
          </div>
        {% endif %}
      </div>

      <!-- Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯ -->
      <div id="tab-new" class="rounded-2xl border border-slate-100 bg-slate-50/60 p-5 {% if active_request_tab != 'new' %}hidden{% endif %}">
        <h4 class="font-bold text-slate-900">Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯</h4>
        <p class="text-xs text-slate-500 mt-1">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·Ø© ÙˆØ§Ø±ÙÙ‚ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„.</p>

        {{ plans_map|json_script:"plans-map" }}

        <div class="mt-4 rounded-2xl border border-slate-200 bg-white p-4">
          <p class="text-xs font-bold text-slate-700 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</p>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
              <p class="text-[11px] text-slate-500">Ø³Ø¹Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø±.Ø³)</p>
              <p id="plan-price" class="font-bold text-slate-900">â€”</p>
            </div>
            <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
              <p class="text-[11px] text-slate-500">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</p>
              <p id="plan-duration" class="font-bold text-slate-900">â€”</p>
            </div>
            <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
              <p class="text-[11px] text-slate-500">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</p>
              <p id="plan-max-screens" class="font-bold text-slate-900">â€”</p>
            </div>
          </div>
        </div>

        <form method="post" enctype="multipart/form-data" class="mt-4 space-y-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="new">

          {% if new_form.non_field_errors %}
            <div class="text-sm text-rose-700">{{ new_form.non_field_errors }}</div>
          {% endif %}

          <div>
            <label class="block text-xs font-semibold text-slate-700 mb-1">{{ new_form.plan.label }}</label>
            {{ new_form.plan }}
            {% if new_form.plan.errors %}
              <div class="text-xs text-rose-700 mt-1">{{ new_form.plan.errors }}</div>
            {% endif %}
          </div>

          <div>
            <label class="block text-xs font-semibold text-slate-700 mb-1">{{ new_form.receipt_image.label }}</label>
            {{ new_form.receipt_image }}
            {% if new_form.receipt_image.errors %}
              <div class="text-xs text-rose-700 mt-1">{{ new_form.receipt_image.errors }}</div>
            {% endif %}
          </div>

          <div>
            <label class="block text-xs font-semibold text-slate-700 mb-1">{{ new_form.transfer_note.label }}</label>
            {{ new_form.transfer_note }}
            {% if new_form.transfer_note.errors %}
              <div class="text-xs text-rose-700 mt-1">{{ new_form.transfer_note.errors }}</div>
            {% endif %}
          </div>

          <button type="submit" class="w-full rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2">
            Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯
          </button>
        </form>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ­Ø§Ù„ØªÙ‡Ø§ -->
    <div class="px-5 md:px-8 pb-6">
      <div class="flex items-center justify-between mb-3">
        <h4 class="font-bold text-slate-900">Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h4>
        <span class="text-xs text-slate-500">Ø¢Ø®Ø± 10 Ø·Ù„Ø¨Ø§Øª</span>
      </div>

      <div class="overflow-x-auto rounded-2xl border border-slate-100 bg-white">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-50 text-slate-600">
            <tr>
              <th class="px-4 py-3 text-right font-semibold">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th class="px-4 py-3 text-right font-semibold">Ø§Ù„Ù†ÙˆØ¹</th>
              <th class="px-4 py-3 text-right font-semibold">Ø§Ù„Ø®Ø·Ø©</th>
              <th class="px-4 py-3 text-right font-semibold">Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th class="px-4 py-3 text-right font-semibold">Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th class="px-4 py-3 text-right font-semibold">Ø§Ù„Ø¥ÙŠØµØ§Ù„</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100">
            {% for r in subscription_requests %}
              <tr class="hover:bg-slate-50/60">
                <td class="px-4 py-3 text-slate-700">{{ r.created_at|date:"Y-m-d" }}</td>
                <td class="px-4 py-3 text-slate-700">{{ r.get_request_type_display }}</td>
                <td class="px-4 py-3 text-slate-700">{{ r.plan.name }}</td>
                <td class="px-4 py-3 text-slate-700">{{ r.amount }} Ø±.Ø³</td>
                <td class="px-4 py-3">
                  <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold
                    {% if r.status == 'approved' %}bg-emerald-100 text-emerald-700
                    {% elif r.status == 'rejected' %}bg-rose-100 text-rose-700
                    {% elif r.status == 'under_review' %}bg-amber-100 text-amber-700
                    {% else %}bg-slate-100 text-slate-700{% endif %}">
                    {{ r.get_status_display }}
                  </span>
                </td>
                <td class="px-4 py-3">
                  {% if r.receipt_image %}
                    <a href="{{ r.receipt_image.url }}" target="_blank" class="text-sky-700 hover:text-sky-900 font-semibold text-xs">
                      Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„
                    </a>
                  {% else %}
                    <span class="text-xs text-slate-400">â€”</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="6" class="px-4 py-6 text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<script>
  (function () {
    function setActiveTab(tab) {
      var renewal = document.getElementById('tab-renewal');
      var fresh = document.getElementById('tab-new');
      if (!renewal || !fresh) return;

      if (tab === 'new') {
        renewal.classList.add('hidden');
        fresh.classList.remove('hidden');
      } else {
        fresh.classList.add('hidden');
        renewal.classList.remove('hidden');
      }

      var btns = document.querySelectorAll('.request-tab-btn');
      btns.forEach(function (b) {
        var isActive = b.getAttribute('data-tab') === tab;
        if (isActive) {
          b.classList.add('bg-white', 'text-slate-900', 'shadow-sm');
          b.classList.remove('text-slate-600');
        } else {
          b.classList.remove('bg-white', 'text-slate-900', 'shadow-sm');
          b.classList.add('text-slate-600');
        }
      });
    }

    // tab buttons
    document.querySelectorAll('.request-tab-btn').forEach(function (btn) {
      btn.addEventListener('click', function () {
        setActiveTab(btn.getAttribute('data-tab') || 'renewal');
      });
    });

    // plan details (new request)
    function updatePlanDetails() {
      var script = document.getElementById('plans-map');
      if (!script) return;
      var plans = {};
      try { plans = JSON.parse(script.textContent || '{}'); } catch (e) { plans = {}; }

      var select = document.querySelector('select[name="new-plan"]');
      if (!select) return;
      var planId = select.value;
      var d = plans[String(planId)] || null;

      var priceEl = document.getElementById('plan-price');
      var durEl = document.getElementById('plan-duration');
      var maxEl = document.getElementById('plan-max-screens');
      if (!priceEl || !durEl || !maxEl) return;

      if (!d) {
        priceEl.textContent = 'â€”';
        durEl.textContent = 'â€”';
        maxEl.textContent = 'â€”';
        return;
      }

      priceEl.textContent = (d.price !== undefined && d.price !== null && d.price !== '') ? d.price : 'â€”';
      durEl.textContent = (d.duration_days !== undefined && d.duration_days !== null) ? String(d.duration_days) : 'â€”';
      maxEl.textContent = (d.max_screens !== undefined && d.max_screens !== null) ? String(d.max_screens) : 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯';
    }

    var planSelect = document.querySelector('select[name="new-plan"]');
    if (planSelect) {
      planSelect.addEventListener('change', updatePlanDetails);
      updatePlanDetails();
    }

    // initial tab
    setActiveTab('{% if active_request_tab == "new" %}new{% else %}renewal{% endif %}');
  })();

  // Copy to clipboard function
  function copyToClipboard(text, button) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function() {
        showCopyFeedback(button, true);
      }).catch(function() {
        fallbackCopy(text, button);
      });
    } else {
      fallbackCopy(text, button);
    }
  }

  function fallbackCopy(text, button) {
    var textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    try {
      var success = document.execCommand('copy');
      showCopyFeedback(button, success);
    } catch (e) {
      showCopyFeedback(button, false);
    }
    document.body.removeChild(textarea);
  }

  function showCopyFeedback(button, success) {
    var textSpan = button.querySelector('.copy-text');
    if (!textSpan) return;
    
    var originalText = textSpan.textContent;
    textSpan.textContent = success ? 'âœ“ ØªÙ… Ø§Ù„Ù†Ø³Ø®' : 'âœ— ÙØ´Ù„';
    button.classList.add('bg-emerald-700');
    
    setTimeout(function() {
      textSpan.textContent = originalText;
      button.classList.remove('bg-emerald-700');
    }, 2000);
  }
</script>
{% endblock %}
