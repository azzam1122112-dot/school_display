<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…{% endblock %}</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  {% load static %}

  <style>
    html, body {
      height: 100%;
      font-family: 'Cairo', sans-serif;
    }

    .nav-item {
      transition: all .3s ease;
      position: relative;
      overflow: hidden;
    }
    .nav-item::before {
      content:"";
      position:absolute;
      top:0;
      right:-100%;
      width:100%;
      height:100%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
      transition:right .5s;
    }
    .nav-item:hover::before {
      right:100%;
    }
    .active-nav {
      background: linear-gradient(135deg,#4f46e5,#7c3aed);
      color:white;
      box-shadow:0 4px 15px rgba(79,70,229,.3);
    }
  </style>
</head>

<body class="min-h-full bg-gradient-to-br from-slate-50 to-slate-100 text-slate-900">

<!-- â–‘â–‘ Header â–‘â–‘ -->
<header class="bg-white/80 backdrop-blur-md shadow-lg sticky top-0 z-40 border-b border-slate-200/60">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">

    <div class="flex items-center space-x-reverse space-x-3">
      {% if request.user.is_authenticated and request.user.profile.school and request.user.profile.school.logo %}
        <img src="{{ request.user.profile.school.logo.url }}"
             class="h-10 w-10 rounded-xl border bg-white object-contain">
      {% else %}
        <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600
                    flex justify-center items-center text-white font-bold text-lg">ğŸ«</div>
      {% endif %}

      <div>
        <h1 class="text-2xl font-extrabold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent">
          Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        </h1>
        <p class="text-xs text-slate-500 mt-1">
          {{ school_name|default:"Ù…Ø¯Ø±Ø³ØªÙ†Ø§" }}
        </p>
      </div>
    </div>

    <div class="flex items-center space-x-reverse space-x-4">

      {# ÙƒØ±Øª "Ø§Ø´ØªØ±Ø§ÙƒÙŠ" Ø§Ù„ØµØºÙŠØ± ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± #}
      {% with sub=request.school_subscription %}
        {% if sub %}
          <div class="hidden md:flex flex-col items-end bg-slate-50 border border-slate-200 rounded-2xl px-4 py-2 text-[11px] leading-snug shadow-sm">
            <div class="flex items-center mb-1">
              <span class="ml-1 text-xs">ğŸ“¦</span>
              <span class="font-semibold text-slate-800">Ø§Ø´ØªØ±Ø§ÙƒÙŠ</span>
            </div>
            <div class="text-slate-700">
              {% if sub.plan %}
                <span class="font-semibold">{{ sub.plan.name }}</span>
              {% endif %}
            </div>
            <div class="text-slate-500">
              Ù…Ù† {{ sub.starts_at|date:"Y-m-d" }}
              {% if sub.ends_at %}
                Ø­ØªÙ‰ {{ sub.ends_at|date:"Y-m-d" }}
              {% else %}
                â€“ Ù…ÙØªÙˆØ­ Ø§Ù„Ù…Ø¯Ø©
              {% endif %}
            </div>
            <div class="mt-1">
              {% if sub.is_active %}
                <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 text-[10px] font-semibold">
                  Ù†Ø´Ø·
                </span>
              {% else %}
                <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-rose-50 text-rose-700 text-[10px] font-semibold">
                  ØºÙŠØ± ÙØ¹Ø§Ù„
                </span>
              {% endif %}
            </div>
          </div>
        {% endif %}
      {% endwith %}


      <div class="flex items-center gap-2">
        <div class="bg-slate-100 px-3 py-1.5 rounded-full text-sm">
          <span>Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ</span>
          <span class="font-semibold">
            {% if request.user.is_authenticated %}
              {{ request.user.get_short_name|default:request.user.username }}
            {% else %}
              Ø¶ÙŠÙ
            {% endif %}
          </span>
        </div>
        {% if request.user.is_authenticated and request.user.profile.schools.all|length > 1 %}
        <div class="relative group">
          <button class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 shadow-sm text-xs font-semibold focus:outline-none">
            {% if request.user.profile.active_school %}
              {{ request.user.profile.active_school.name }}
            {% else %}
              Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³Ø©
            {% endif %}
            <svg class="w-4 h-4 text-slate-500 group-hover:text-slate-700 transition-transform duration-200 transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
          </button>
          <div class="absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform scale-95 group-hover:scale-100">
            {% for school in request.user.profile.schools.all %}
              <a href="{% url 'dashboard:switch_school' school.id %}"
                 class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 {% if school == request.user.profile.active_school %}font-semibold bg-slate-50{% endif %}">
                {{ school.name }}
                {% if school == request.user.profile.active_school %}<span class="ml-2 text-emerald-600">(Ù†Ø´Ø·Ø©)</span>{% endif %}
              </a>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>

      {% if request.user.is_authenticated %}
        <a href="{% url 'dashboard:logout' %}"
           class="text-sm bg-gradient-to-r from-red-500 to-rose-600 text-white px-4 py-1.5 rounded-full
                  hover:shadow-lg hover:scale-105 transition-all duration-300">
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </a>
      {% endif %}
    </div>
  </div>
</header>

{# â–‘â–‘ Banner ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ â–‘â–‘ #}
{% if request.user.is_authenticated %}
  {% with sub=request.school_subscription %}
    {% if sub and sub.is_active and sub.days_left and sub.days_left <= 10 %}
      <div class="bg-gradient-to-r from-amber-500 to-rose-500 text-white">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row items-center justify-between gap-3">
          <div class="flex items-center gap-2">
            <span class="text-xl">â°</span>
            <div>
              <div class="text-sm md:text-base font-semibold">
                Ù…ØªØ¨Ù‚Ù‘ÙŠ {{ sub.days_left }} ÙŠÙˆÙ…{% if sub.days_left != 1 %}Ø§Ù‹{% endif %} Ø¹Ù„Ù‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ø´ØªØ±Ø§ÙƒÙƒ.
              </div>
              <div class="text-xs md:text-sm text-amber-50/90">
                Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù…Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø¯ÙˆÙ† Ø§Ù†Ù‚Ø·Ø§Ø¹ØŒ ÙŠÙÙØ¶Ù‘Ù„ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¨ÙƒØ±Ù‹Ø§.
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <a href="https://wa.me/966546868219?text=%D8%AA%D8%AC%D8%AF%D9%8A%D8%AF%20%D8%A7%D8%B4%D8%AA%D8%B1%D8%A7%D9%83%20%D9%84%D9%88%D8%AD%D8%A9%20%D8%A7%D9%84%D8%B9%D8%B1%D8%B6"
               target="_blank"
               class="inline-flex items-center px-3 py-1.5 rounded-full bg-white/10 border border-white/30 text-xs md:text-sm font-semibold hover:bg-white/20 transition">
              <span class="ml-1">ğŸ’¬</span>
              ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
            </a>
            <a href="mailto:xmansx1122@gmail.com?subject=%D8%AA%D8%AC%D8%AF%D9%8A%D8%AF%20%D8%A7%D8%B4%D8%AA%D8%B1%D8%A7%D9%83&body=%D8%A3%D8%B1%D8%BA%D8%A8%20%D9%81%D9%8A%20%D8%AA%D8%AC%D8%AF%D9%8A%D8%AF%20%D8%A7%D8%B4%D8%AA%D8%B1%D8%A7%D9%83%20%D9%85%D8%AF%D8%B1%D8%B3%D8%AA%D9%86%D8%A7"
               class="inline-flex items-center px-3 py-1.5 rounded-full bg-white text-rose-600 text-xs md:text-sm font-semibold hover:bg-amber-50 transition">
              <span class="ml-1">ğŸ“§</span>
              Ù…Ø±Ø§Ø³Ù„Ø© Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯
            </a>
          </div>
        </div>
      </div>
    {% endif %}
  {% endwith %}
{% endif %}

<div class="max-w-7xl mx-auto px-4 py-6 grid grid-cols-12 gap-6">

  <!-- â–‘â–‘ Nav Sidebar â–‘â–‘ -->
  <aside class="col-span-12 md:col-span-3">
    <nav class="bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-white/50 space-y-2">

      <!-- Home -->
      <a href="{% url 'dashboard:index' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'index' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">ğŸ“Š</span>
          <span class="font-medium">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </div>
      </a>

      <!-- Subscription -->
      <a href="{% url 'dashboard:my_subscription' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'my_subscription' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">ğŸ’³</span>
          <span class="font-medium">Ø§Ø´ØªØ±Ø§ÙƒÙŠ</span>
        </div>
      </a>

      <!-- Settings -->
      <a href="{% url 'dashboard:settings' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'settings' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">âš™ï¸</span>
          <span class="font-medium">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</span>
        </div>
      </a>

      <!-- Screens -->
      <a href="{% url 'dashboard:screen_list' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'screen_list' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">ğŸ–¥ï¸</span>
          <span class="font-medium">Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</span>
        </div>
      </a>

      <!-- Days -->
      <a href="{% url 'dashboard:days_list' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'days_list' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">ğŸ“…</span>
          <span class="font-medium"> Ø¥Ø¯Ø§Ø±Ø© ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ø­Øµ Ùˆ Ø§Ù„Ø£ÙŠØ§Ù…</span>
        </div>
      </a>

      <!-- Timetable -->
      <a href="{% url 'dashboard:timetable_day' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'timetable_day' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">ğŸ—“ï¸</span>
          <span class="font-medium">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
        </div>
      </a>

      <!-- Announcements -->
      <a href="{% url 'dashboard:ann_list' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'ann_list' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">ğŸ””</span>
          <span class="font-medium">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
        </div>
      </a>

      <!-- Excellence -->
      <a href="{% url 'dashboard:exc_list' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'exc_list' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">â­</span>
          <span class="font-medium">Ù‚Ø³Ù… Ø§Ù„ØªÙ…ÙŠÙ‘Ø²</span>
        </div>
      </a>

      <!-- Standby -->
      <a href="{% url 'dashboard:standby_list' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'standby_list' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">â³</span>
          <span class="font-medium">Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>
        </div>
      </a>

      <!-- School Data -->
      <a href="{% url 'dashboard:school_data' %}"
         class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'school_data' %}active-nav{% else %}bg-white/80{% endif %}">
        <div class="flex items-center">
          <span class="ml-2 text-lg">ğŸ«</span>
          <span class="font-medium">Ø§Ø¯Ø§Ø±Ø© Ø§Ù„ÙØµÙˆÙ„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ùˆ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</span>
        </div>
      </a>

      <!-- SaaS Super Admin -->
      {% if request.user.is_superuser %}
        <div class="border-t border-slate-200 my-3"></div>
        <div class="px-2 pb-1 text-[11px] font-semibold text-slate-500">
          Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (SaaS)
        </div>

        <a href="{% url 'dashboard:system_admin_dashboard' %}"
           class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'system_admin_dashboard' %}active-nav{% else %}bg-white/80{% endif %}">
          <div class="flex items-center">
            <span class="ml-2 text-lg">ğŸ§©</span>
            <span class="font-medium">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</span>
          </div>
        </a>

        <a href="{% url 'dashboard:system_schools_list' %}"
           class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'system_schools_list' %}active-nav{% else %}bg-white/80{% endif %}">
          <div class="flex items-center">
            <span class="ml-2 text-lg">ğŸ«</span>
            <span class="font-medium">Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</span>
          </div>
        </a>

        <a href="{% url 'dashboard:system_users_list' %}"
           class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'system_users_list' %}active-nav{% else %}bg-white/80{% endif %}">
          <div class="flex items-center">
            <span class="ml-2 text-lg">ğŸ‘¤</span>
            <span class="font-medium">Ù…Ø³ØªØ®Ø¯Ù…Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
          </div>
        </a>

        <a href="{% url 'dashboard:system_subscriptions_list' %}"
           class="nav-item block px-4 py-3 rounded-xl border transition-all
               {% if request.resolver_match.url_name == 'system_subscriptions_list' %}active-nav{% else %}bg-white/80{% endif %}">
          <div class="flex items-center">
            <span class="ml-2 text-lg">ğŸ’³</span>
            <span class="font-medium">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</span>
          </div>
        </a>
      {% endif %}
    </nav>

    <div class="mt-6 text-center">
      <div class="text-xs text-slate-500 bg-white/60 backdrop-blur-sm rounded-xl py-3 px-4 shadow border border-white/50">
        <div class="font-medium text-slate-700 mb-1">Â© {{ school_name|default:"Ù…Ø¯Ø±Ø³ØªÙ†Ø§" }}</div>
        <div class="text-slate-500">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</div>
      </div>
    </div>
  </aside>


  <!-- â–‘â–‘ Main Content â–‘â–‘ -->
  <main class="col-span-12 md:col-span-9">

    {% if messages %}
      <div class="space-y-3 mb-6">
        {% for m in messages %}
          <div class="px-5 py-3 rounded-xl backdrop-blur-sm border-l-4 shadow-sm
              {% if m.tags == 'success' %} bg-emerald-50/80 border-emerald-500 text-emerald-700
              {% elif m.tags == 'error' %} bg-red-50/80 border-red-500 text-red-700
              {% else %} bg-sky-50/80 border-sky-500 text-sky-700
              {% endif %}">
            <div class="flex items-center">
              {% if m.tags == 'success' %}
                <span class="ml-2 text-lg">âœ…</span>
              {% elif m.tags == 'error' %}
                <span class="ml-2 text-lg">âŒ</span>
              {% else %}
                <span class="ml-2 text-lg">â„¹ï¸</span>
              {% endif %}
              <span class="font-medium">{{ m }}</span>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}


    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border overflow-hidden">

      <div class="border-b border-slate-200/60 bg-gradient-to-r from-slate-50 to-white px-6 py-4">
        <h2 class="text-xl font-bold text-slate-800">
          {% block page_title %}Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©{% endblock %}
        </h2>
        <p class="text-slate-600 text-sm mt-1">
          {% block page_description %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ØªÙ„ÙØ©{% endblock %}
        </p>
      </div>

      <div class="p-6">
        {% block content %}
        <p class="text-slate-600 text-center">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….</p>
        {% endblock %}
      </div>

    </div>
  </main>
</div>

</body>
</html>
